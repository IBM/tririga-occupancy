<link rel="import" href="../triplat-view-behavior/triplat-view-behavior.html">
<link rel="import" href="../triblock-app-layout/triblock-app-layout.html">
<link rel="import" href="../triplat-routing/triplat-routing.html">

<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../google-chart/google-chart.html">
<link rel="import" href="../google-map/google-map.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-badge/paper-badge.html">

<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../triblock-table/triblock-table.html">
<link rel="import" href="../triblock-table-column/triblock-table-column.html">
<link rel="import" href="../triplat-calendar-container/triplat-calendar-container.html">
<link rel="import" href="../triplat-date-picker/triplat-date-picker.html">
<link rel="import" href="../triplat-datetime-picker/triplat-datetime-picker.html">
<link rel="import" href="../triplat-select-input/triplat-select-input.html">
<link rel="import" href="../triplat-graphic/triplat-graphic.html">
<link rel="import" href="../triblock-scroll-container/triblock-scroll-container.html">
<link rel="import" href="../iron-dropdown/iron-dropdown.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../triplat-title/triplat-title.html">
<link rel="import" href="../iron-image/iron-image.html">



<!-- <link rel="stylesheet" href="./leaflet.css" />
<script src="./leaflet.js"></script> -->

<!-- Mapping  -->

<!-- <link rel="import" href="leaflet-map.html">
<link rel="import" href="leaflet-marker.html">

<script type="text/javascript" src="webcomponents-lite.min.js"></script> -->
<!-- Mapping end -->

<link rel="import" href="tut-occupancy-styles.html">

<!-- Mapping end -->

<dom-module id="tut-occupancy">
	<template>
		<style include="tut-occupancy-styles">
		</style>

		<triplat-route id="homeRoute" name="home" path="/"></triplat-route>
		<triplat-route id="reportsRoute" name="reports" path="/reports"></triplat-route>
		<triplat-route id="detailedRoute" name="detailed" path="/detailed"></triplat-route>
		<triplat-route id="watsonRoute" name="watson" path="/watson"></triplat-route>

		<triblock-app-layout
			app-label="Building Insights Dashboard"
			mobile-page-label="Building Insights Dashboard"
			show-mobile-back-button>

			<!-- Enable to customize app-title -->
			<div app-title>
				<span><b>App tut-occupancy</b></span>
			</div>

			<!-- <paper-item value$="{{ajaxBuildings.id}}">{{index}} - {{item.id}} - {{item.name}}</paper-item> -->
			<!-- <paper-listbox multi>
				<paper-item value="{{ajaxBuildings}}"</paper-item>
			<paper-listbox> -->

			<triblock-banner-button tap-handler="_navigateToHome" home></triblock-banner-button>
			<triblock-banner-button tap-handler="_navigateBack" back></triblock-banner-button>

			<triblock-banner-button icon="ibm:table-tables" label="Reports" triplat-route-id="reportsRoute"></triblock-banner-button>
			<triblock-banner-button icon="ibm:world-globe" label="Watson Analytics" triplat-route-id="watsonRoute"></triblock-banner-button>

			<triplat-route-selector content>
				<iron-pages>
					<section route="home" default-route>
						<!-- <triplat-title title-label="Space Assessment"></triplat-title> -->
						<div>
						  <!-- <span><triplat-title title-label="Space Assessment"></triplat-title></span> -->
							<span><p> Building Insights Dashboard </p></span>
							<!-- <span>
							 <triplat-date-picker value="{{value}}"></triplat-date-picker>
  						</span> -->

							 <!-- <paper-listbox selected="0">
							   <paper-item>Item 1</paper-item>
							   <paper-item>Item 2</paper-item>
							 </paper-listbox> -->

							<!-- <paper-menu>
							  <paper-item>Item 1</paper-item>
							  <paper-item>Item 2</paper-item>
							</paper-menu> -->

							<!-- <select multiple>
							          <option value="American">American flamingo</option>
							          <option value="Andean">Andean flamingo</option>
							          <option value="Chilean">Chilean flamingo</option>
							          <option value="Greater">Greater flamingo</option>
							          <option value="James's">James's flamingo</option>
							          <option value="Lesser">Lesser flamingo</option>
							</select> -->
							<div style="margin-left: auto;margin-right: auto;">
						  <iron-image  style="width:100%; height:400px; margin:auto;" src="./esri_placeholder.png" sizing="contain"></iron-image>
							</div>
							<br>

								<!-- <leaflet-map fit-to-markers>
						      <leaflet-marker longitude="77.2" latitude="28.4">
						        Marker I
						      </leaflet-marker>
						    </leaflet-map> -->
							<!-- </span> -->

							<!-- <span>
							<triblock-table id="table1"  data="{{ajaxBuildings}}" style="width:100%; height:250px;">
								    <triblock-table-column title="Occupancy Stats" property="id"></triblock-table-column>
							</triblock-table>
							</span> -->

							<span>
							<!-- TODO, table should reflect mutiple columns; building id, occupancy, percentage, prediction -->
							<!-- TODO, add last update  -->
							<triblock-table id="table1"  title="Occupancy Stats" data="{{ajaxSampleTable}}" style="width:100%; height:500px;">
								    <triblock-table-column title="Building" property="id"></triblock-table-column>
										<triblock-table-column title="Occupancy" property="Occupancy"></triblock-table-column>
										<triblock-table-column title="Percentage" property="Percentage"></triblock-table-column>
										<triblock-table-column title="Prediction (Next hour)" property="Prediction"></triblock-table-column>
							</triblock-table>
							</span>


							<!-- <span>
							 <triplat-graphic drawing-id="1026"></triplat-graphic>
  						</span> -->
							<div>
							<google-chart
								style="width:100%; height:400px;"
							  type='line'
							  options='{"title": "Estate Occupancy (24hr)"}'
								data="{{ajaxLineData}}"
							</google-chart>
							</div>
							<div>
								<span>
								<google-chart
   								style="width:100%; height:400px;"
								  type='column'
								  options='{"title": "Building Occupancy vs Energy Consumption"}'
									data="{{ajaxOEData}}"
								</google-chart>
								</span>
								<google-chart
								  type='pie'
								  options='{"title": "Buildings by Occupancy"}'
									data="{{ajaxData}}"
								</google-chart>
								</span>
								<paper-card heading="Last Updated">
									<!-- <div class="card-content">"{{ajaxLineData}}"</div> -->
									<div class="card-content">2019-01-20T00:00:00.000+0000</div>
									<!-- <div class="card-actions">
										<paper-button>Some action</paper-button>
									</div> -->
								</paper-card>
							</div>
							<br>
							<br>
							<br>
							<br>
							<!-- <div style="float:left">
							<span>
								<google-chart
								  type='column'
								  options='{"title": "Sample Detailed Occupancy"}'
									data="{{ajaxSampleOccupancy}}"
								</google-chart>
							</span>
							</div> -->

							<div>
								<paper-dropdown-menu label="Select Building" style="width:40%">  <!-- vertical-align> -->
								  <paper-listbox attr-for-selected="id" class="dropdown-content" fallback-selection="default" selected="1">
								    <template is="dom-repeat" items="{{ajaxBuildings}}">
								      <paper-item id="{{item.id}}">{{item.id}}</paper-item>
								    </template>
								  </paper-listbox>
								</paper-dropdown-menu>
								<!-- <span> -->
								  <triplat-datetime-picker style="width:40%" value="{{value}}">
										<!-- <iron-icon label icon="av:play-arrow"></iron-icon> -->
									  <span label>Select Time & Date</span>
									</triplat-datetime-picker>

								<triblock-table id="tablebuilding"  title="Building Detailed" data="{{ajaxSingleBuilding}}" style="width:100%; height:500px;">
											<triblock-table-column title="Floor" property="id"></triblock-table-column>
											<triblock-table-column title="Occupancy" property="Occupancy"></triblock-table-column>
											<triblock-table-column title="Percentage" property="Percentage"></triblock-table-column>
											<triblock-table-column title="Prediction (Next hour)" property="Prediction"></triblock-table-column>
											<!-- <triblock-table-column title="Demographics?" property="Prediction"></triblock-table-column> -->
								</triblock-table>
							</div>
							<span>
								<iron-dropdown horizontal-align="right" vertical-align="top">
								  <div class="dropdown-content">Hello!</div>
								</iron-dropdown>
							</span>

							<button on-click="toggle">toggle collapse</button>
							<iron-collapse id="collapse">
							  <div>Content goes here...</div>
							</iron-collapse>

							<span>
							<triblock-table id="table1"  data="{{ajaxBuildings}}" style="width:80%">
								    <triblock-table-column title="Building ID" property="id"></triblock-table-column>
							</triblock-table>
							</span>
							<!-- generate key, add weather -->
							<!-- http://${TRIRIGA_IP}:8001/tririga/p/web/doc#!/triplat-weather/ -->
							<!-- Where's the "TRIRIGAWEB.properties file", need to set the WEATHER_API_KEY property -->
							<!-- </span> -->
							<!-- <p>map</p> -->
							<!-- <div id="map"></div> -->
						</div>


						<!-- <google-map latitude="37.77493" longitude="-122.41942" fit-to-markers>
						 <google-map-marker latitude="37.779" longitude="-122.3892"
								 draggable="true" title="Go Giants!"></google-map-marker>
						 <google-map-marker latitude="37.777" longitude="-122.38911"></google-map-marker>
					 </google-map> -->
						<iron-ajax auto url="http://5b7a5140.ngrok.io/getsampledata" handle-as="json" last-response="{{ajaxData}}"></iron-ajax>
						<iron-ajax auto url="http://5b7a5140.ngrok.io/getsampleoedata" handle-as="json" last-response="{{ajaxOEData}}"></iron-ajax>
						<iron-ajax auto url="http://5b7a5140.ngrok.io/getsamplelinedata" handle-as="json" last-response="{{ajaxLineData}}"></iron-ajax>
						<iron-ajax auto url="http://5b7a5140.ngrok.io/getbuildings" handle-as="json" last-response="{{ajaxBuildings}}"></iron-ajax>
						<iron-ajax auto url="http://5b7a5140.ngrok.io/getsampleoccupancy" handle-as="json" last-response="{{ajaxSampleOccupancy}}"></iron-ajax>
						<iron-ajax auto url="http://5b7a5140.ngrok.io/getsampletabledata" handle-as="json" last-response="{{ajaxSampleTable}}"></iron-ajax>
						<iron-ajax auto url="http://5b7a5140.ngrok.io/getsinglebuildingdata" handle-as="json" last-response="{{ajaxSingleBuilding}}"></iron-ajax>
					</section>
					<section route="detailed">
						<span>Detailed View</span>
						<span>
						<!-- TODO, table should reflect mutiple columns; building id, occupancy, percentage, prediction -->
						<!-- TODO, add last update  -->
						<!-- Each row is a different floor -->
						<triblock-table id="detailedtable"  title="Occupancy Stats" data="{{ajaxSampleTable}}" style="width:100%; height:250px;">
									<triblock-table-column title="Building" property="id"></triblock-table-column>
									<triblock-table-column title="Occupancy" property="Occupancy"></triblock-table-column>
									<triblock-table-column title="Percentage" property="Percentage"></triblock-table-column>
									<triblock-table-column title="Prediction (Next hour)" property="Prediction"></triblock-table-column>
						</triblock-table>
						<!-- TODO, add line graph? -->
						</span>
						<!-- <iron-ajax auto url="http://fe1c7f46.ngrok.io/getsampledata" handle-as="json" last-response="{{ajaxData}}"></iron-ajax>
						<iron-ajax auto url="http://fe1c7f46.ngrok.io/getsamplelinedata" handle-as="json" last-response="{{ajaxLineData}}"></iron-ajax>
						<iron-ajax auto url="http://fe1c7f46.ngrok.io/getbuildings" handle-as="json" last-response="{{ajaxBuildings}}"></iron-ajax>
						<iron-ajax auto url="http://fe1c7f46.ngrok.io/getsampleoccupancy" handle-as="json" last-response="{{ajaxSampleOccupancy}}"></iron-ajax>
						<iron-ajax auto url="http://fe1c7f46.ngrok.io/getsampletabledata" handle-as="json" last-response="{{ajaxSampleTable}}"></iron-ajax> -->
					</section>
					<section route="reports">
						<span>Reports Page</span>
					</section>
					<section route="watson">
						<span>Watson Analytics Page</span>
					</section>
				</iron-pages>
			</triplat-route-selector>
<!-- TODO, add link to locate app at /tririga/p/web/locate#!/room/-1 -->
		</triblock-app-layout>

	</template>
</dom-module>
<script defer>
	// var map = L.map("map").setView([37.75, -122.23], 10);
	// L.esri.basemapLayer("Topographic").addTo(map);
	setTimeout(function(){
		 console.log("drawing map")
		 // var map = L.map('map').setView([51.505, -0.09], 13);
		 // L.esri.basemapLayer("Topographic").addTo(map)
	}, 3000);
</script>
<script>

	// var mymap = L.map('mapid').setView([51.505, -0.09], 13);

	Polymer({

		is: "tut-occupancy",

		behaviors: [TriPlatViewBehavior],

		_navigateToHome: function() {
			this.$.homeRoute.navigate();
		},

		_navigateBack: function() {
			window.history.back();
		},

		properties: {
				headers: {
						type: Object,
						value: function() { return {}; }
				},
				user: String,
				pass: String
		},

    makeHeaders: function(user,pass){
        return "Basic " + window.btoa(user + ":" + pass);
    },

		_setBasicAuth: function(user, pass) {
	      this.headers['Authorization'] = this.makeHeaders(user, pass);
		},

		toggle: function() {
		  	this.$.collapse.toggle();
		}

	});

</script>
